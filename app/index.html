<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Object Detection Control</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: #f5f5f5;
    }
    .categories {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      max-width: 800px;
      margin-bottom: 40px;
    }
    .category {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100px;
      height: 100px;
      background: white;
      border: 2px solid #ccc;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .category.selected {
      border-color: #007bff;
      background-color: #e7f0ff;
    }
    .category i {
      font-size: 24px;
      margin-bottom: 5px;
    }
    #startBtn {
      padding: 15px 30px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #startBtn.active {
      background-color: #dc3545;
    }
    #startBtn:hover {
      background-color: #0056b3;
    }
    #startBtn.active:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>
  <div class="categories" id="categories">
    <!-- Categories will be generated dynamically -->
  </div>
  <button id="startBtn">Start Detection</button>

  <script>
    const categories = [
      "aeroplane", "bicycle", "bird", "boat", "bottle", "bus", "car",
      "cat", "chair", "cow", "diningtable", "dog", "horse", "motorbike",
      "person", "pottedplant", "sheep", "sofa", "train", "tvmonitor"
    ];

    const icons = {
      aeroplane: "fa-plane", bicycle: "fa-bicycle", bird: "fa-dove",
      boat: "fa-ship", bottle: "fa-wine-bottle", bus: "fa-bus", car: "fa-car",
      cat: "fa-cat", chair: "fa-chair", cow: "fa-cow", diningtable: "fa-table",
      dog: "fa-dog", horse: "fa-horse", motorbike: "fa-motorcycle", person: "fa-user",
      pottedplant: "fa-seedling", sheep: "fa-hippo", sofa: "fa-couch",
      train: "fa-train", tvmonitor: "fa-tv"
    };

    const container = document.getElementById("categories");
    const startBtn = document.getElementById("startBtn");
    let isDetecting = false;

    categories.forEach(category => {
      const div = document.createElement("div");
      div.className = "category";
      div.dataset.name = category;
      div.innerHTML = `<i class="fas ${icons[category] || 'fa-box'}"></i><span>${category}</span>`;
      div.addEventListener("click", () => {
        div.classList.toggle("selected");
      });
      container.appendChild(div);
    });

    startBtn.addEventListener("click", () => {
      if (!isDetecting) {
        const selected = Array.from(document.querySelectorAll(".category.selected"))
                              .map(el => el.dataset.name);

        fetch("/start_detection", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ targets: selected })
        })
        .then(res => res.json())
        .then(data => {
          isDetecting = true;
          startBtn.textContent = "Stop Detection";
          startBtn.classList.add("active");
        })
        .catch(err => alert("Error: " + err));
      } else {
        fetch("/stop_detection", {
          method: "POST"
        })
        .then(res => res.json())
        .then(data => {
          isDetecting = false;
          startBtn.textContent = "Start Detection";
          startBtn.classList.remove("active");
        })
        .catch(err => alert("Error: " + err));
      }
    });
  </script>
</body>
</html>